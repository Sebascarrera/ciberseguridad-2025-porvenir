:root{
  --ok:#06d6a0;
  --bad:#ef476f;
  --ink:#ffffff;
  --panel: rgba(0,0,0,.65);
  --panel-2: rgba(0,0,0,.35);
  --stroke: rgba(255,255,255,.12);
  --accent:#3a86ff;
  /* Altura del “suelo” responsive */
  --ground-h: clamp(48px, 9vh, 82px);
}

/* evita que un overflow arriba rompa el sticky */
html, body { overflow-y: auto; }

/* ===== Wrapper ===== */
.em-play-wrap{
  position:relative;
  min-height:100dvh;
  color:var(--ink);
  overflow-x:hidden;
  background:#0a0e13;
  display:flex;
  flex-direction:column;
}

/* ===== Parallax layers (dentro del stage) ===== */
.em-play-wrap .em-bg{
  position:absolute; inset:0;
  background-repeat: repeat-x;
  background-position-y: bottom;
  image-rendering:auto;
  pointer-events:none;
  will-change: background-position;
}
/* Capas 1–3 siempre en movimiento */
.em-play-wrap .em-bg.l1{
  background-image: var(--em-bg1);
  background-size: auto 104%;
  animation: em-bg-pan-1 40s linear infinite;
  z-index:1; opacity:.55;
}
.em-play-wrap .em-bg.l2{
  background-image: var(--em-bg2);
  background-size: auto 108%;
  animation: em-bg-pan-2 24s linear infinite;
  z-index:2; opacity:.75;
}
.em-play-wrap .em-bg.l3{
  background-image: var(--em-bg3);
  background-size: auto 100%;
  animation: em-bg-pan-3 14s linear infinite;
  z-index:3;
}
/* Capa 4: sólo con tramo (JS controla --em-bg4-x) */
.em-play-wrap .em-bg.l4{
  background-image: var(--em-bg4);
  background-size: auto 110%;
  background-position-x: var(--em-bg4-x);
  z-index:4;
}
/* Pan infinito */
@keyframes em-bg-pan-1{ 0%{background-position-x:0} 100%{background-position-x:-1400px} }
@keyframes em-bg-pan-2{ 0%{background-position-x:0} 100%{background-position-x:-2000px} }
@keyframes em-bg-pan-3{ 0%{background-position-x:0} 100%{background-position-x:-2600px} }

/* ===== Efectos NEÓN ===== */
.em-play-wrap .em-neon-glow,
.em-play-wrap .em-neon-scan,
.em-play-wrap .em-neon-sparkles{
  position:absolute; inset:0; pointer-events:none; mix-blend-mode: screen;
}
.em-play-wrap .em-neon-glow{
  z-index: 4;
  background:
    radial-gradient(40% 30% at 20% 30%, rgba(58,134,255,.18), transparent 60%),
    radial-gradient(35% 28% at 75% 25%, rgba(255,62,150,.16), transparent 65%),
    radial-gradient(55% 40% at 50% 80%, rgba(6,214,160,.12), transparent 70%);
  filter: blur(10px) saturate(120%);
  animation: neon-glow-pulse 5.5s ease-in-out infinite;
}
@keyframes neon-glow-pulse{
  0%,100%{ opacity:.65; transform: scale(1) }
  50%{ opacity:.95; transform: scale(1.03) }
}
.em-play-wrap .em-neon-scan{
  z-index: 4;
  background: linear-gradient(100deg,
    rgba(255,255,255,0) 0%,
    rgba(180,220,255,.10) 45%,
    rgba(180,220,255,.22) 50%,
    rgba(180,220,255,.10) 55%,
    rgba(255,255,255,0) 100%);
  transform: translateX(-120%);
  animation: neon-scan 6.5s linear infinite;
  filter: blur(1px);
}
@keyframes neon-scan{ 0%{ transform: translateX(-120%) } 100%{ transform: translateX(120%) } }
.em-play-wrap .em-neon-sparkles{
  z-index: 4;
  background:
    radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(2px 2px at 30% 40%, rgba(255,215,0,.55), rgba(255,255,255,0) 60%),
    radial-gradient(2px 2px at 60% 25%, rgba(58,134,255,.55), rgba(255,255,255,0) 60%),
    radial-gradient(2px 2px at 80% 35%, rgba(6,214,160,.55), rgba(255,255,255,0) 60%),
    radial-gradient(2px 2px at 50% 15%, rgba(255,62,150,.55), rgba(255,255,255,0) 60%);
  opacity:.5;
  animation: neon-twinkle 2.4s steps(2,end) infinite;
}
@keyframes neon-twinkle{ 0%,100%{ opacity:.35; filter: brightness(1) } 50%{ opacity:.7; filter: brightness(1.35) } }

/* ===== Confeti ===== */
.em-play-wrap .em-confetti{
  position:fixed !important; inset:0 !important; width:100vw !important; height:100vh !important;
  pointer-events:none !important; z-index: 9999 !important; display:block !important;
}

/* ===== HUD ===== */
.em-play-wrap .em-hud{
  position:relative; z-index:10;
  display:grid; grid-template-columns: 1fr 1.4fr 1fr; align-items:center; gap:10px;
  padding:14px clamp(12px, 4vw, 24px);
}
.em-play-wrap .em-ghost-btn{ background:transparent; border:1px solid var(--stroke); color:var(--ink); padding:8px 12px; border-radius:12px; }
.em-play-wrap .em-progress{ display:flex; flex-direction:column; gap:6px; align-items:center; }
.em-play-wrap .em-progress-track{ width:min(460px, 70vw); height:8px; border-radius:999px; background:rgba(255,255,255,.12); overflow:hidden; }
.em-play-wrap .em-progress-fill{ height:100%; background: linear-gradient(90deg, var(--accent), #7cc9ff); }
.em-play-wrap .em-hud-right{ display:flex; align-items:center; gap:14px; justify-content:flex-end; }
.em-play-wrap .em-score{ background:var(--panel); border:1px solid var(--stroke); border-radius:12px; padding:8px 12px; min-width:90px; text-align:center; }
.em-play-wrap .em-score .lbl{ font-size:12px; opacity:.8; display:block; }
.em-play-wrap .em-score .val{ font-weight:800; font-size:20px; letter-spacing:.4px; }

/* Vidas */
.em-play-wrap .em-lives{ display:flex; gap:6px; }
.em-play-wrap .em-heart{ opacity:.3; filter: drop-shadow(0 0 6px rgba(239,71,111,.35)); }
.em-play-wrap .em-heart.on{ opacity:1; transform: scale(1.05); }

/* ===== Stage ===== */
.em-play-wrap .em-stage{
  position:relative; z-index:5;
  flex: 1 1 auto;
  min-height: 54vh;
  padding-bottom: clamp(12px, 4vh, 64px);
  transition: transform .18s ease;
}
.em-play-wrap .em-stage.running{ animation: em-camera-kick .4s ease; }
@keyframes em-camera-kick{ 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-2px) } }

/* Speedlines – respeta el suelo */
.em-play-wrap .em-speedlines-canvas{
  position:absolute; left:0; right:0; top:0;
  bottom: var(--ground-h) !important; /* override seguro */
  z-index:5; pointer-events:none; mix-blend-mode: screen; opacity:.95;
}

/* Suelo */
.em-play-wrap .em-ground{
  position:absolute; left:0; right:0; bottom:0;
  height: var(--ground-h) !important;  /* override seguro */
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.08));
  border-top:1px solid rgba(255,255,255,.12);
  box-shadow: 0 -10px 30px rgba(0,0,0,.3) inset;
  z-index:5;
}

/* ===== Avatar / Obstáculo pegados al suelo ===== */
.em-play-wrap .em-avatar{
  position:absolute;
  left: 10%;
  bottom: var(--ground-h) !important; /* evita que un 70px viejo gane */
  width:min(160px, 26vw);
  aspect-ratio: 1 / 1;
  transform-origin:center bottom;
  z-index: 6;
}
.em-play-wrap .em-avatar-sprite img{ width:100%; height:100%; object-fit: contain; user-select:none; }
.em-play-wrap .em-avatar-sprite.run{ animation: em-bob 1s ease-in-out infinite; }
@keyframes em-bob{ 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-4px) } }
.em-play-wrap .em-avatar-sprite.jump{ animation: em-jump 1.05s cubic-bezier(.2,.7,0,1) both; }
@keyframes em-jump{
  0%{ transform: translateY(0) }
  30%{ transform: translateY(-120px) }
  60%{ transform: translateY(-120px) }
  100%{ transform: translateY(0) }
}
.em-play-wrap .em-avatar-sprite.crash{ animation: em-crash .7s ease both; filter: saturate(.9) brightness(.9); }
@keyframes em-crash{
  0%{ transform: translateX(0) }
  20%{ transform: translateX(-12px) rotate(-6deg) }
  40%{ transform: translateX(10px) rotate(4deg) }
  60%{ transform: translateX(-8px) rotate(-3deg) }
  100%{ transform: translateX(0) rotate(0) }
}
.em-play-wrap .em-avatar.advance.good{ animation: em-advance-good 1.0s cubic-bezier(.2,.7,0,1) both; }
.em-play-wrap .em-avatar.advance.bad { animation: em-advance-bad  1.0s cubic-bezier(.2,.7,0,1) both; }
@keyframes em-advance-good{ 0%{ transform: translateX(0) } 100%{ transform: translateX(28vw) } }
@keyframes em-advance-bad { 0%{ transform: translateX(0) } 100%{ transform: translateX(10vw) } }

/* Obstáculo (Malware) */
.em-play-wrap .em-obstacle{
  position:absolute;
  left: 76%;
  bottom: var(--ground-h) !important; /* override */
  width:min(150px, 22vw);
  aspect-ratio: 1/1;
  z-index: 6;
  will-change: transform;
}
.em-play-wrap .em-obstacle-sprite img{ width:100%; height:100%; object-fit: contain; user-select:none; }
.em-play-wrap .em-obstacle-sprite{ animation: em-bob-obs 1s ease-in-out infinite; }
@keyframes em-bob-obs{
  0%,100%{ transform: translateY(0) }
  50%{ transform: translateY(-3px) }
}
.em-play-wrap .em-obstacle.approach.good{ animation: em-approach-cross 1.1s cubic-bezier(.2,.7,0,1) both; }
.em-play-wrap .em-obstacle.approach.bad { animation: em-approach-cross-hit 1.1s cubic-bezier(.2,.7,0,1) both; }
@keyframes em-approach-cross{
  0%   { transform: translateX(0) }
  38%  { transform: translateX(-40vw) }
  100% { transform: translateX(-120vw) }
}
@keyframes em-approach-cross-hit{
  0%   { transform: translateX(0) }
  28%  { transform: translateX(-34vw) }
  34%  { transform: translateX(-40vw) rotate(-5deg) scale(1.05) }
  40%  { transform: translateX(-38vw) rotate( 4deg) }
  46%  { transform: translateX(-41vw) rotate(-3deg) }
  52%  { transform: translateX(-40vw) rotate( 0deg) }
  100% { transform: translateX(-120vw) }
}

/* ===== Panel de preguntas (abajo, sticky en móvil) ===== */
.em-play-wrap .em-quiz{
  position:relative; z-index:7;
  padding: 10px clamp(12px, 4vw, 24px) calc(12px + env(safe-area-inset-bottom));
  background: linear-gradient(180deg, rgba(8,12,16,.86), rgba(8,12,16,.95));
  border-top: 1px solid var(--stroke);
  box-shadow: 0 -10px 40px rgba(0,0,0,.35);
}
@media (max-width: 840px){
  .em-play-wrap .em-quiz{
    position: sticky;
    bottom: 0;
  }
}
.em-play-wrap .em-card{
  margin: 0 auto;
  width:min(900px, 96vw);
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  border:1px solid var(--stroke); border-radius:16px; padding:16px;
  box-shadow: 0 10px 42px rgba(0,0,0,.35);
  backdrop-filter: blur(2px);
  animation: em-card-in .25s ease both;
}
@keyframes em-card-in{ from{ transform: translateY(6px); opacity:0 } to{ transform: translateY(0); opacity:1 } }
.em-play-wrap .em-q{ margin:0 0 10px 0; font-size: clamp(16px, 2.4vw, 20px); text-align:center; }

/* Opciones */
.em-play-wrap .em-opts{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; }
@media (max-width: 760px){
  .em-play-wrap .em-opts{ grid-template-columns: 1fr; }
  .em-play-wrap .em-opt{ font-size: 16px; padding:12px 14px; }
}
.em-play-wrap .em-opt{
  padding:10px 12px; border-radius:12px; border:1px solid var(--stroke);
  background: var(--panel); color:#fff; text-align:center; font-weight:600;
  transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
}
.em-play-wrap .em-opt:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); box-shadow: 0 10px 24px rgba(0,0,0,.25); }
.em-play-wrap .em-opt:active{ transform: translateY(0); }

/* ===== Modal fin ===== */
.em-play-wrap .em-modal-wrap{
  position:fixed; inset:0; display:grid; place-items:center;
  background: rgba(0,0,0,.55);
  z-index: 999;
  padding:12px; box-sizing:border-box;
  animation: em-fade .2s ease;
}
@keyframes em-fade{ from{ opacity:0 } to{ opacity:1 } }
.em-play-wrap .em-modal{
  width:min(520px, 92vw);
  max-width:92vw;
  max-height: calc(100dvh - 48px);
  overflow:auto; overscroll-behavior: contain;
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid var(--stroke); border-radius:18px; padding:24px;
  box-shadow: 0 20px 48px rgba(0,0,0,.5);
  box-sizing:border-box;
}
.em-play-wrap .em-results{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:12px 0 18px; }
@media (max-width: 420px){
  .em-play-wrap .em-modal{ padding:20px; }
  .em-play-wrap .em-results{ grid-template-columns:1fr; }
}
.em-play-wrap .em-modal-actions{ display:flex; gap:10px; justify-content:center; }
.em-play-wrap .em-btn{
  min-width:160px; padding:12px 14px; border-radius:12px;
  border:1px solid var(--stroke); background: var(--panel);
  color:#fff; font-weight:700; letter-spacing:.4px;
}
.em-play-wrap .em-btn.ok{ background: linear-gradient(180deg, rgba(6,214,160,.22), rgba(6,214,160,.05)); border-color: rgba(6,214,160,.35); }
.em-play-wrap .em-btn.sec{ background: linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.05)); }

/* ===== Responsive HUD ===== */
@media (max-width: 820px){
  .em-play-wrap .em-hud{ grid-template-columns: 1fr; gap:8px; text-align:center; }
  .em-play-wrap .em-hud .em-ghost-btn{ justify-self:center; }
  .em-play-wrap .em-hud-right{ justify-content:center; }
  .em-play-wrap .em-progress-track{ width: 84vw; }
}

/* ===== Pantallas pequeñas extra ===== */
@media (max-width: 420px){
  .em-play-wrap .em-stage{ min-height: 58vh; }
}

/* =========================
   COMPACT PROFILES (mobile-first)
   ========================= */

/* XS phones (≤360px) */
@media (max-width: 360px){
  :root{ --ground-h: clamp(44px, 9vh, 70px); }
  .em-play-wrap .em-hud{ padding:10px 10px; gap:6px; grid-template-columns: 1fr; text-align:center; }
  .em-play-wrap .em-progress-track{ width: 86vw; height: 7px; }
  .em-play-wrap .em-score{ padding:6px 10px; min-width:80px; }
  .em-play-wrap .em-score .val{ font-size:18px; }
  .em-play-wrap .em-ghost-btn{ padding:6px 10px; border-radius:10px; font-size:14px; }
  .em-play-wrap .em-stage{ min-height: 60vh; padding-bottom: clamp(8px, 3vh, 40px); }
  .em-play-wrap .em-avatar{ left: 10%; width: min(136px, 34vw); }
  .em-play-wrap .em-obstacle{ left: 62%; width: min(132px, 30vw); }
  .em-play-wrap .em-quiz{ padding: 8px 12px calc(10px + env(safe-area-inset-bottom)); }
  .em-play-wrap .em-card{ padding:12px; width:min(900px, 96vw); }
  .em-play-wrap .em-q{ font-size: clamp(15px, 4.4vw, 18px); }
  .em-play-wrap .em-opts{ gap:8px; }
  .em-play-wrap .em-opt{ padding:10px 12px; font-size:15px; border-radius:10px; }
  .em-play-wrap .em-tip{ font-size:11px; }
}

/* Small phones (361–390px) */
@media (min-width: 361px) and (max-width: 390px){
  :root{ --ground-h: clamp(46px, 7vh, 76px); }
  .em-play-wrap .em-hud{ padding:12px 14px; gap:6px; }
  .em-play-wrap .em-progress-track{ width: 84vw; height: 4px; }
  .em-play-wrap .em-score{ padding:7px 11px; min-width:86px; }
  .em-play-wrap .em-score .val{ font-size:14px; }
  .em-play-wrap .em-ghost-btn{ padding:7px 11px; border-radius:11px; font-size:14px; }
  .em-play-wrap .em-stage{ min-height: 40vh; padding-bottom: clamp(20px, 3.5vh, 48px); }
  .em-play-wrap .em-avatar{ left: 3%; width: min(148px, 28vw); }
  .em-play-wrap .em-obstacle{ left: 75%; width: min(140px, 20vw); }
  .em-play-wrap .em-card{ padding:16px; }
  .em-play-wrap .em-q{ font-size: clamp(13px, 4.1vw, 16px); }
  .em-play-wrap .em-opt{ padding:11px 13px; font-size:14px; }
}

/* Medium phones (391–430px) */
@media (min-width: 391px) and (max-width: 430px){
  :root{ --ground-h: clamp(50px, 9.5vh, 82px); }
  .em-play-wrap .em-hud{ padding:12px 16px; }
  .em-play-wrap .em-progress-track{ width: 82vw; height: 8px; }
  .em-play-wrap .em-score .val{ font-size:20px; }
  .em-play-wrap .em-stage{ min-height: 56vh; padding-bottom: clamp(12px, 4vh, 56px); }
  .em-play-wrap .em-avatar{ left: 12%; width: min(156px, 30vw); }
  .em-play-wrap .em-obstacle{ left: 64%; width: min(150px, 28vw); }
  .em-play-wrap .em-card{ padding:16px; }
  .em-play-wrap .em-q{ font-size: clamp(16px, 3.8vw, 20px); }
  .em-play-wrap .em-opt{ padding:12px 14px; font-size:16px; }
}

/* Height-constrained (≤640px) */
@media (max-height: 640px){
  .em-play-wrap .em-stage{ min-height: 62vh; padding-bottom: 8px; }
  .em-play-wrap .em-speedlines-canvas{ bottom: calc(var(--ground-h) - 4px) !important; }
  .em-play-wrap .em-quiz{ padding-top: 6px; padding-bottom: calc(8px + env(safe-area-inset-bottom)); }
  .em-play-wrap .em-card{ padding:12px; }
  .em-play-wrap .em-q{ margin-bottom:8px; }
  .em-play-wrap .em-opt{ padding:10px 12px; }
}

/* Tablet portrait (768–1024 px) */
@media (min-width: 768px) and (max-width: 1024px){
  :root{ --ground-h: clamp(60px, 7.5vh, 90px); }
  .em-play-wrap .em-stage{ min-height: 50vh; padding-bottom: clamp(12px, 3vh, 48px); }
  .em-play-wrap .em-opts{ grid-template-columns: 1fr 1fr; gap:12px; }
  .em-play-wrap .em-q{ font-size: clamp(18px, 2.2vw, 22px); }
  .em-play-wrap .em-opt{ font-size: 17px; padding:12px 16px; }
}

/* Tablet/desktop “apretado” (ancho ≥600 y alto ≤740) */
@media (min-width: 600px) and (max-height: 740px){
  .em-play-wrap .em-stage{ min-height: 52vh; }
  .em-play-wrap .em-quiz{ position:relative; }
}

/* 1) quita margen por defecto del body (si tu reset no lo hace) */
body { margin: 0; }

/* 2) asegura centrado perfecto del panel en móvil */
.em-play-wrap .em-quiz{
  /* padding simétrico y consciente del notch */
  padding-inline: clamp(12px, 4vw, 24px);
  padding-left: max(env(safe-area-inset-left), clamp(12px, 4vw, 24px));
  padding-right: max(env(safe-area-inset-right), clamp(12px, 4vw, 24px));
  box-sizing: border-box;
}

/* 3) la tarjeta ocupa el ancho disponible del contenedor (sin sumar vw + padding) */
.em-play-wrap .em-card{
  width: 100%;            /* << antes era 96vw */
  max-width: 900px;       /* límite en desktop/tablet */
  margin-inline: auto;    /* centrado real */
  box-sizing: border-box; /* padding cuenta dentro del width */
}

/* (opcional) si algún estilo global está metiendo padding/margen a sections/divs, neutralízalo aquí */
@media (max-width: 840px){
  .em-play-wrap .em-quiz{
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  .em-play-wrap .em-card{
    margin-left: auto !important;
    margin-right: auto !important;
  }
}
